<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Energía Solar para Todos – Gráficas y Tablas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header class="site-header">
  <div class="title-bar">
    <h1>Energía Solar para Todos</h1>
    <p class="subtitle">
      Explora el potencial de la energía solar y contribuye a un futuro sostenible.
    </p>
  </div>

  <nav class="main-nav">
    <a href="index.html">Inicio</a>
    <a href="mapa.html">Mapa Interactivo</a>
    <a href="graficas.html">Gráficas y Tablas</a>
    <a href="info.html">Información y Guía</a>
  </nav>
</header>

<main class="container">

    <!-- ========================================================= -->
    <!-- 1. Gráficas principales: solo energía solar fotovoltaica -->
    <!-- ========================================================= -->
    <section class="panel">
        <h2>Capacidad y generación solar fotovoltaica (2010–2024)</h2>
        <p>
            Estas dos gráficas muestran la <strong>capacidad instalada</strong> (MW)
            y la <strong>generación eléctrica</strong> (GWh) de la tecnología
            <strong>Solar Fotovoltaica</strong> en el SEN, usando tus datos reales (2010–2024).
            En cada gráfico también se incluye la
            <strong>participación porcentual de la FV en el total nacional</strong> (%).
        </p>

        <div class="grid-2">
            <div>
                <h3>Capacidad instalada FV (MW) y participación (%)</h3>
                <canvas id="chartCapSolar"></canvas>
            </div>
            <div>
                <h3>Generación FV (GWh) y participación (%)</h3>
                <canvas id="chartGenSolar"></canvas>
            </div>
        </div>
    </section>

    <!-- ========================================================= -->
    <!-- 2. Mix nacional del SEN: 1 gráfica + tabla                -->
    <!-- ========================================================= -->
    <section class="panel">
        <div class="panel-header">
            <h2>Mix eléctrico nacional del SEN (2010–2024)</h2>
            <div class="view-toggle">
                <button id="btnViewCharts" class="btn primary">Ver gráficas</button>
                <button id="btnViewTable" class="btn">Ver tabla</button>
            </div>
        </div>

        <p>
            Aquí se muestran las series nacionales del SEN. Puedes elegir qué variable
            ver en la gráfica (capacidad, generación, demanda o consumos).
        </p>

        <!-- CONTENEDOR DE GRÁFICAS NACIONALES -->
        <div id="mixCharts">
            <div class="controls-row">
                <label>
                    Variable del SEN:
                    <select id="senVariableSelect">
                        <option value="capacidad">Capacidad total (MW)</option>
                        <option value="generacion">Generación total (GWh)</option>
                        <option value="demanda">Demanda máxima integrada (MW)</option>
                        <option value="consumo">Consumo bruto y final (GWh)</option>
                    </select>
                </label>
            </div>
            <canvas id="chartSEN"></canvas>
        </div>

        <!-- TABLA NACIONAL (SE MUESTRA AL ELEGIR "VER TABLA") -->
        <div id="mixTable" style="display:none; overflow-x:auto;">
            <h3>Tabla de datos del SEN (2010–2024)</h3>
            <table class="data-table">
                <thead>
                <tr>
                    <th>Año</th>
                    <th>Capacidad total (MW)</th>
                    <th>Generación total (GWh)</th>
                    <th>Demanda máx. SEN (MW)</th>
                    <th>Consumo bruto SEN (GWh)</th>
                    <th>Consumo final SEN (GWh)</th>
                </tr>
                </thead>
                <tbody id="mixTableBody"><!-- se llena con JS --></tbody>
            </table>
        </div>
    </section>

    <!-- ========================================================= -->
    <!-- 3. Series por región del SEN (valor + porcentaje)        -->
    <!-- ========================================================= -->
    <section class="panel">
        <h2>Series por región del SEN (valor y participación %)</h2>

        <p>
            En esta sección puedes elegir una <strong>región</strong> y una
            <strong>variable</strong>. La gráfica usa dos ejes:
            <br>
            – <strong>Eje izquierdo:</strong> valor de la región (MW o GWh), mostrado como área / línea.<br>
            – <strong>Eje derecho:</strong> participación porcentual de la región en el SEN (%), como línea.
        </p>

        <div class="controls-row">
            <label>
                Región:
                <select id="regionSelect">
                    <option value="CEN">CEN</option>
                    <option value="ORI">ORI</option>
                    <option value="OCC">OCC</option>
                    <option value="NOR">NOR</option>
                    <option value="NTE">NTE</option>
                    <option value="NES">NES</option>
                    <option value="PEN">PEN</option>
                </select>
            </label>

            <label>
                Variable:
                <select id="variableSelect">
                    <option value="demanda">Demanda máxima integrada (MW)</option>
                    <option value="consumoBruto">Consumo bruto (GWh)</option>
                    <option value="consumoFinal">Consumo final (GWh)</option>
                </select>
            </label>
        </div>

        <canvas id="chartRegion"></canvas>

        <h3>Tabla de datos de la región seleccionada</h3>
        <div style="overflow-x:auto;">
            <table class="data-table">
                <thead>
                <tr>
                    <th>Año</th>
                    <th>Valor región</th>
                    <th>Valor SEN</th>
                    <th>Participación región</th>
                </tr>
                </thead>
                <tbody id="regionTableBody"><!-- se llena con JS --></tbody>
            </table>
        </div>
    </section>

</main>

<footer class="footer">
    <p>Proyecto personal de visualización de energía solar y sistema eléctrico nacional.</p>
</footer>

<!-- ============================================================= -->
<!--  JAVASCRIPT – todas las series con tus datos reales           -->
<!-- ============================================================= -->
<script>
/* =======================
   0. Datos base (2010–2024)
   ======================= */
const years = [2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];

/* 1) Solar fotovoltaica (capacidad y generación) */
const capSolar = [0, 0, 1, 11, 55, 57, 145, 171, 1878, 3646, 5149, 5955, 6515, 7437, 7961];       // MW
const genSolar = [0, 0, 3, 20, 83, 45, 151, 349, 2176, 8394, 13528, 17069, 16290, 18210, 18640];  // GWh

/* Porcentaje FV respecto al total nacional (capacidad / generación) */
const capShare = [0.0, 0.0, 0.0, 0.02, 0.09, 0.09, 0.2, 0.25, 2.57, 4.65, 6.19, 6.91, 7.48, 8.36, 8.79];
const genShare = [0.0, 0.0, 0.0, 0.01, 0.03, 0.02, 0.05, 0.12, 0.7, 2.64, 4.33, 5.28, 4.88, 5.26, 5.29];

/* 2) Totales SEN (todas las tecnologías) */
const capTotal   = [55090, 54656, 55692, 57413, 62359, 63545, 73242, 68051, 72958, 78447, 83122, 86154, 87131, 89007, 90543]; // MW
const genTotal   = [271483, 277894, 281545, 286218, 280365, 287660, 298426, 302880, 310686, 317821, 312348, 323527, 333964, 346501, 352305]; // GWh
const yearsDem   = years.slice(); // mismos años
const demandaSen = [41750, 43324, 43920, 44323, 44398, 45601, 47348, 49049, 50825, 52340, 51225, 52686, 54489, 57958, 59601]; // MW
const consumoBrutoSen  = [253460, 269831, 275033, 275497, 280161, 288224, 298792, 309726, 318233, 324921, 315969, 329032, 340613, 351584, 359807]; // GWh
const consumoFinalSen  = [199713, 214098, 219994, 222830, 228635, 237200, 248195, 258895, 268701, 274915, 266238, 277259, 288687, 298599, 304012]; // GWh

/* 3) Series por región (DEMANDA, CONSUMO BRUTO, CONSUMO FINAL) */
const regiones = ["CEN","ORI","OCC","NOR","NTE","NES","PEN"];

// Demanda máxima integrada (MW) por región
const demandaRegion = {
    "CEN": [9004, 8844, 8651, 8411, 8192, 8151, 8567, 8705, 8805, 8754, 8717, 8450, 8466, 8619, 8848],
    "ORI": [6356, 6577, 6626, 6709, 6767, 6960, 7128, 7299, 7594, 7923, 7461, 7868, 8203, 8783, 9034],
    "OCC": [8175, 8669, 8975, 9207, 9104, 9374, 9351, 9842, 10373, 10096, 9763, 10292, 10537, 11478, 11834],
    "NOR": [3617, 3772, 3870, 4087, 4034, 4154, 4350, 4582, 4759, 5310, 5220, 5343, 5342, 5808, 5909],
    "NTE": [3385, 3682, 3725, 3841, 3955, 3986, 4258, 4608, 4639, 4851, 4976, 5042, 5343, 5446, 5540],
    "NES": [7070, 7587, 7798, 7781, 7876, 8248, 8710, 8846, 9202, 9707, 9399, 9674, 10237, 10962, 11109],
    "PEN": [1520, 1544, 1558, 1628, 1664, 1789, 1893, 1955, 2061, 2246, 2014, 2210, 2372, 2698, 2969]
};

// Consumo bruto (GWh) por región
const consumoBrutoRegion = {
    "CEN": [58422, 59303, 59061, 58086, 57423, 57844, 59103, 60685, 61293, 60853, 57429, 58272, 59866, 60160, 60059],
    "ORI": [40098, 42447, 43835, 44224, 44901, 46587, 47642, 48583, 50285, 51655, 50436, 53051, 54643, 56633, 58547],
    "OCC": [51407, 55871, 57470, 57779, 59345, 61025, 62808, 66696, 68107, 69697, 68154, 70900, 73763, 76564, 77541],
    "NOR": [17339, 19251, 20097, 20466, 21089, 21642, 23389, 24293, 24684, 24966, 26104, 26449, 26332, 28259, 29126],
    "NTE": [20403, 22116, 22484, 22679, 23150, 23734, 24696, 25949, 27000, 28868, 29291, 29808, 30596, 31905, 32711],
    "NES": [43442, 47379, 47776, 47581, 48559, 50114, 52895, 54423, 56426, 57411, 54239, 57901, 60806, 62170, 64080],
    "PEN": [9206, 9735, 9938, 10300, 10635, 11610, 12129, 12498, 12989, 13872, 12497, 13613, 14677, 16054, 16930]
};

// Consumo final (GWh) por región
const consumoFinalRegion = {
    "CEN": [34789, 36540, 37792, 38818, 39064, 40364, 45070, 46423, 48269, 48590, 46362, 47262, 48988, 49709, 49411],
    "ORI": [31734, 33567, 34836, 35292, 35986, 37286, 38423, 39607, 41840, 42709, 40722, 42530, 44503, 46528, 48022],
    "OCC": [45144, 48599, 49959, 50428, 51952, 53884, 53290, 57743, 58995, 60871, 59536, 61885, 64629, 66822, 67732],
    "NOR": [14567, 16264, 16895, 17263, 17796, 18497, 20017, 20823, 21277, 21441, 22247, 22332, 22580, 24037, 24651],
    "NTE": [17052, 18340, 18656, 18743, 19596, 20368, 21231, 22466, 23565, 24592, 24508, 24699, 25268, 25909, 26592],
    "NES": [37261, 40608, 40941, 40989, 41947, 43231, 45455, 45957, 47973, 48723, 45613, 49321, 51806, 53160, 53876],
    "PEN": [7732, 8142, 8354, 8660, 9032, 9730, 10342, 11055, 11399, 12425, 11204, 11827, 13043, 14414, 14934]
};

// Participaciones (%) región / SEN
const demandaShare = {
    "CEN": [21.57, 20.41, 19.7, 18.98, 18.45, 17.87, 18.09, 17.75, 17.32, 16.73, 17.02, 16.04, 15.54, 14.87, 14.85],
    "ORI": [15.22, 15.18, 15.09, 15.14, 15.24, 15.26, 15.05, 14.88, 14.94, 15.14, 14.57, 14.93, 15.05, 15.15, 15.16],
    "OCC": [19.58, 20.01, 20.43, 20.77, 20.51, 20.56, 19.75, 20.07, 20.41, 19.29, 19.06, 19.53, 19.34, 19.8, 19.86],
    "NOR": [8.66, 8.71, 8.81, 9.22, 9.09, 9.11, 9.19, 9.34, 9.36, 10.15, 10.19, 10.14, 9.8, 10.02, 9.91],
    "NTE": [8.11, 8.5, 8.48, 8.67, 8.91, 8.74, 8.99, 9.39, 9.13, 9.27, 9.71, 9.57, 9.81, 9.4, 9.3],
    "NES": [16.93, 17.51, 17.76, 17.56, 17.74, 18.09, 18.4, 18.04, 18.11, 18.55, 18.35, 18.36, 18.79, 18.91, 18.64],
    "PEN": [3.64, 3.56, 3.55, 3.67, 3.75, 3.92, 4.0, 3.99, 4.06, 4.29, 3.93, 4.19, 4.35, 4.66, 4.98]
};
const consumoBrutoShare = {
    "CEN": [23.05, 21.98, 21.47, 21.08, 20.5, 20.07, 19.78, 19.59, 19.26, 18.73, 18.18, 17.71, 17.58, 17.11, 16.69],
    "ORI": [15.82, 15.73, 15.94, 16.05, 16.03, 16.16, 15.94, 15.69, 15.8, 15.9, 15.96, 16.12, 16.04, 16.11, 16.27],
    "OCC": [20.28, 20.71, 20.9, 20.97, 21.18, 21.17, 21.02, 21.53, 21.4, 21.45, 21.57, 21.55, 21.66, 21.78, 21.55],
    "NOR": [6.84, 7.13, 7.31, 7.43, 7.53, 7.51, 7.83, 7.84, 7.76, 7.68, 8.26, 8.04, 7.73, 8.04, 8.09],
    "NTE": [8.05, 8.2, 8.18, 8.23, 8.26, 8.23, 8.27, 8.38, 8.48, 8.88, 9.27, 9.06, 8.98, 9.07, 9.09],
    "NES": [17.14, 17.56, 17.37, 17.27, 17.33, 17.39, 17.7, 17.57, 17.73, 17.67, 17.17, 17.6, 17.85, 17.68, 17.81],
    "PEN": [3.63, 3.61, 3.61, 3.74, 3.8, 4.03, 4.06, 4.04, 4.08, 4.27, 3.96, 4.14, 4.31, 4.57, 4.71]
};
const consumoFinalShare = {
    "CEN": [17.42, 17.07, 17.18, 17.42, 17.09, 17.02, 18.16, 17.93, 17.96, 17.67, 17.41, 17.05, 16.97, 16.65, 16.25],
    "ORI": [15.89, 15.68, 15.83, 15.84, 15.74, 15.72, 15.48, 15.3, 15.57, 15.54, 15.3, 15.34, 15.42, 15.58, 15.8],
    "OCC": [22.6, 22.7, 22.71, 22.63, 22.72, 22.72, 21.47, 22.3, 21.96, 22.14, 22.36, 22.32, 22.39, 22.38, 22.28],
    "NOR": [7.29, 7.6, 7.68, 7.75, 7.78, 7.8, 8.07, 8.04, 7.92, 7.8, 8.36, 8.05, 7.82, 8.05, 8.11],
    "NTE": [8.54, 8.57, 8.48, 8.41, 8.57, 8.59, 8.55, 8.68, 8.77, 8.95, 9.21, 8.91, 8.75, 8.68, 8.75],
    "NES": [18.66, 18.97, 18.61, 18.39, 18.35, 18.23, 18.31, 17.75, 17.85, 17.72, 17.13, 17.79, 17.95, 17.8, 17.72],
    "PEN": [3.87, 3.8, 3.8, 3.89, 3.95, 4.1, 4.17, 4.27, 4.24, 4.52, 4.21, 4.27, 4.52, 4.83, 4.91]
};

/* =======================
   1. Funciones de apoyo
   ======================= */
function makeDualSolarChart(ctx, labels, serieValor, serieShare, labelValor, yLabelIzq) {
    return new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: labelValor,
                    data: serieValor,
                    yAxisID: 'y',
                    fill: true,
                    tension: 0.25
                },
                {
                    label: 'Participación FV en el total (%)',
                    data: serieShare,
                    yAxisID: 'y1',
                    fill: false,
                    tension: 0.25,
                    borderDash: [5,4]
                }
            ]
        },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { position: 'top' },
                tooltip: { mode: 'index', intersect: false }
            },
            scales: {
                x: { title: { display: true, text: 'Año' } },
                y: {
                    title: { display: true, text: yLabelIzq },
                    position: 'left'
                },
                y1: {
                    title: { display: true, text: '% de participación' },
                    position: 'right',
                    grid: { drawOnChartArea: false }
                }
            }
        }
    });
}

/* =========================================
   2. Gráficas FV y mix nacional del SEN
   ========================================= */
let chartCapSolar, chartGenSolar, chartSEN;
let chartRegion;

window.addEventListener('load', () => {
    // 2.1 Capacidad y generación SOLAR FV (valor + %)
    chartCapSolar = makeDualSolarChart(
        document.getElementById('chartCapSolar'),
        years, capSolar, capShare,
        'Capacidad FV (MW)', 'MW'
    );
    chartGenSolar = makeDualSolarChart(
        document.getElementById('chartGenSolar'),
        years, genSolar, genShare,
        'Generación FV (GWh)', 'GWh'
    );

    // 2.2 Llenar tabla nacional
    const tbody = document.getElementById('mixTableBody');
    years.forEach((year, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${year}</td>
            <td>${capTotal[idx].toLocaleString('es-MX')}</td>
            <td>${genTotal[idx].toLocaleString('es-MX')}</td>
            <td>${demandaSen[idx].toLocaleString('es-MX')}</td>
            <td>${consumoBrutoSen[idx].toLocaleString('es-MX')}</td>
            <td>${consumoFinalSen[idx].toLocaleString('es-MX')}</td>
        `;
        tbody.appendChild(tr);
    });

    // 2.3 Botones Ver gráficas / Ver tabla
    const btnCharts = document.getElementById('btnViewCharts');
    const btnTable  = document.getElementById('btnViewTable');
    const mixCharts = document.getElementById('mixCharts');
    const mixTable  = document.getElementById('mixTable');

    btnCharts.addEventListener('click', () => {
        mixCharts.style.display = '';
        mixTable.style.display  = 'none';
        btnCharts.classList.add('primary');
        btnTable.classList.remove('primary');
    });
    btnTable.addEventListener('click', () => {
        mixCharts.style.display = 'none';
        mixTable.style.display  = '';
        btnTable.classList.add('primary');
        btnCharts.classList.remove('primary');
    });

    // 2.4 Inicializar gráfica del SEN con selector de variable
    const senSelect = document.getElementById('senVariableSelect');
    senSelect.addEventListener('change', updateSenChart);
    updateSenChart(); // primer render

    // 3. Inicializar sección de regiones
    initRegionSection();
});

/* ===============================
   2.bis. Gráfica SEN (selector)
   =============================== */
function updateSenChart() {
    const variable = document.getElementById('senVariableSelect').value;
    const ctx = document.getElementById('chartSEN');

    if (chartSEN) chartSEN.destroy();

    let datasets = [];
    let yLabel = '';
    let titulo = '';

    if (variable === 'capacidad') {
        titulo = 'Capacidad total instalada del SEN (MW)';
        yLabel = 'MW';
        datasets.push({
            label: 'Capacidad total (MW)',
            data: capTotal,
            fill: true,
            tension: 0.25
        });
    } else if (variable === 'generacion') {
        titulo = 'Generación total del SEN (GWh)';
        yLabel = 'GWh';
        datasets.push({
            label: 'Generación total (GWh)',
            data: genTotal,
            fill: true,
            tension: 0.25
        });
    } else if (variable === 'demanda') {
        titulo = 'Demanda máxima integrada del SEN (MW)';
        yLabel = 'MW';
        datasets.push({
            label: 'Demanda máx. integrada (MW)',
            data: demandaSen,
            fill: true,
            tension: 0.25
        });
    } else { // consumo bruto + final
        titulo = 'Consumo bruto y final del SEN (GWh)';
        yLabel = 'GWh';
        datasets.push(
            {
                label: 'Consumo bruto (GWh)',
                data: consumoBrutoSen,
                fill: true,
                tension: 0.25
            },
            {
                label: 'Consumo final (GWh)',
                data: consumoFinalSen,
                fill: false,
                tension: 0.25
            }
        );
    }

    chartSEN = new Chart(ctx, {
        type: 'line',
        data: {
            labels: years,
            datasets: datasets
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: titulo }
            },
            interaction: { mode: 'index', intersect: false },
            scales: {
                x: { title: { display: true, text: 'Año' } },
                y: { title: { display: true, text: yLabel } }
            }
        }
    });
}

/* =========================================
   3. Gráfica de regiones (valor + %)
   ========================================= */

function getRegionData(variable, region) {
    let serieRegion, serieShare, serieSen;

    if (variable === 'demanda') {
        serieRegion = demandaRegion[region];
        serieShare  = demandaShare[region];
        serieSen    = demandaSen;
    } else if (variable === 'consumoBruto') {
        serieRegion = consumoBrutoRegion[region];
        serieShare  = consumoBrutoShare[region];
        serieSen    = consumoBrutoSen;
    } else { // consumoFinal
        serieRegion = consumoFinalRegion[region];
        serieShare  = consumoFinalShare[region];
        serieSen    = consumoFinalSen;
    }
    return { serieRegion, serieShare, serieSen };
}

function updateRegionChartAndTable() {
    const region   = document.getElementById('regionSelect').value;
    const variable = document.getElementById('variableSelect').value;
    const { serieRegion, serieShare, serieSen } = getRegionData(variable, region);

    let unidad = (variable === 'demanda') ? 'MW' : 'GWh';
    let titulo = '';
    if (variable === 'demanda') titulo = 'Demanda máxima integrada';
    else if (variable === 'consumoBruto') titulo = 'Consumo bruto';
    else titulo = 'Consumo final';

    const ctx = document.getElementById('chartRegion');

    if (chartRegion) chartRegion.destroy();

    chartRegion = new Chart(ctx, {
        type: 'line',
        data: {
            labels: yearsDem,
            datasets: [
                {
                    label: `${titulo} región ${region} (${unidad})`,
                    data: serieRegion,
                    yAxisID: 'y',
                    fill: true,
                    tension: 0.25
                },
                {
                    label: `Participación región ${region} (%)`,
                    data: serieShare,
                    yAxisID: 'y1',
                    fill: false,
                    tension: 0.25
                }
            ]
        },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { position: 'top' },
                tooltip: { mode: 'index', intersect: false }
            },
            scales: {
                x: {
                    title: { display: true, text: 'Año' }
                },
                y: {
                    title: { display: true, text: unidad },
                    position: 'left'
                },
                y1: {
                    title: { display: true, text: 'Participación (%)' },
                    position: 'right',
                    grid: { drawOnChartArea: false }
                }
            }
        }
    });

    // Tabla de región
    const tbody = document.getElementById('regionTableBody');
    tbody.innerHTML = '';
    yearsDem.forEach((year, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${year}</td>
            <td>${serieRegion[idx].toLocaleString('es-MX')}</td>
            <td>${serieSen[idx].toLocaleString('es-MX')}</td>
            <td>${serieShare[idx].toFixed(2)}%</td>
        `;
        tbody.appendChild(tr);
    });
}

function initRegionSection() {
    const regionSel   = document.getElementById('regionSelect');
    const variableSel = document.getElementById('variableSelect');

    regionSel.addEventListener('change', updateRegionChartAndTable);
    variableSel.addEventListener('change', updateRegionChartAndTable);

    // primer render
    updateRegionChartAndTable();
}
</script>

</body>
</html>
