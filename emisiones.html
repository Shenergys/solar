<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SP-Energy | Emisiones</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Computer+Modern+Serif:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Estilos generales (mismos que graficas.html) */
        .chart-wrapper { display: flex; flex-wrap: wrap; gap: 20px; align-items: center; margin-top: 1rem; }
        .chart-area { flex: 3; min-width: 300px; height: 400px; }
        .info-area { 
            flex: 1; min-width: 250px; background: #fff; padding: 20px; 
            border-radius: 8px; border-left: 5px solid #FFD700; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
        }
        .info-area h4 { margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .info-area p { font-size: 0.95rem; line-height: 1.5; color: #555; }
        .highlight { color: #d35400; font-weight: bold; font-size: 1.1em; }

        /* DISEÑO MEJORADO DE FÓRMULA */
        .equation-container {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
        }
        .equation-title {
            font-size: 0.9rem;
            color: #777;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }
        .math-formula {
            font-family: 'Times New Roman', Times, serif;
            font-size: 1.5rem;
            color: #2c3e50;
            font-style: italic;
        }
        .variable { color: #2980b9; font-weight: bold; }
        .operator { color: #7f8c8d; margin: 0 10px; }
        .unit-desc { font-size: 0.8rem; color: #999; margin-top: 5px; font-family: 'Roboto', sans-serif; font-style: normal; }

        /* Referencias */
        .references { background: #222; color: #eee; padding: 40px 20px; margin-top: 50px; font-size: 0.9rem; }
        .references h3 { color: #FFD700; margin-bottom: 20px; border-bottom: 1px solid #444; display: inline-block; }
        .references ul { list-style: none; padding: 0; }
        .references li { margin-bottom: 15px; line-height: 1.4; }
        .references a { color: #ddd; text-decoration: none; font-weight: bold; }
        .references a:hover { color: #FFD700; text-decoration: underline; }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logo-container"><span class="logo-text">SP-ENERGY <span class="sun-icon">☀️</span></span></div>
        <div class="slogan-container"><h1>Energía Solar para Todos</h1></div>
        <div class="spacer"></div> 
    </header>

    <nav class="navbar">
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="mapa.html">Mapa Interactivo</a></li>
            <li><a href="graficas.html">Gráficas y Tablas</a></li>
            <li><a href="emisiones.html" class="active">Emisiones</a></li>
            <li><a href="info.html">Contacto</a></li>
        </ul>
    </nav>

    <main class="main-container">
        <h2 class="section-title">Impacto Ambiental y Emisiones de GEI</h2>

        <section class="graph-card">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
                <h2>Factor de Emisión del SEN (2015–2024)</h2>
                <div class="view-toggle">
                    <button id="btnFactorChart" class="btn primary">Ver gráfica</button>
                    <button id="btnFactorTable" class="btn">Ver tabla</button>
                </div>
            </div>
            <p>Datos históricos reales del factor de emisión eléctrico según reportes oficiales.</p>

            <div id="factorChartContainer">
                <div class="chart-wrapper">
                    <div class="chart-area"><canvas id="chartFactor"></canvas></div>
                    <div class="info-area">
                        <h4>Análisis del Factor</h4>
                        <p>El factor de emisión cerró 2024 en <span class="highlight" id="valFactor24"></span> tCO₂e/MWh.</p>
                        <p>Se observa una tendencia a la baja respecto al pico de 2018, indicando una paulatina descarbonización de la red.</p>
                    </div>
                </div>
            </div>

            <div id="factorTableContainer" style="display:none; overflow-x:auto;">
                <table class="data-table">
                    <thead><tr><th>Año</th><th>Factor de Emisión (tCO₂e/MWh)</th></tr></thead>
                    <tbody id="factorTableBody"></tbody>
                </table>
            </div>
        </section>

        <section class="graph-card">
            <h2>Emisiones Totales Asociadas a la Generación</h2>
            
            <div class="equation-container">
                <span class="equation-title">Metodología de Cálculo</span>
                <div class="math-formula">
                    <span class="variable">Emisiones</span> 
                    <span class="operator">=</span> 
                    <span class="variable">Consumo Bruto</span> 
                    <span class="operator">×</span> 
                    <span class="variable">Factor de Emisión</span>
                </div>
                <div class="unit-desc">(tCO₂e) = (MWh) × (tCO₂e/MWh)</div>
            </div>

            <div class="chart-wrapper">
                <div class="chart-area"><canvas id="chartEmissions"></canvas></div>
                <div class="info-area" id="emissionsInfo">
                    <h4>Evolución 2015-2024</h4>
                    </div>
            </div>
        </section>

        <section class="graph-card" style="border-top: 5px solid #27ae60;">
            <h2>Impacto Positivo: Emisiones Evitadas por Energía Solar</h2>
            <p>Toneladas de CO₂ equivalente que se dejaron de emitir gracias a la generación fotovoltaica en el periodo 2015-2024.</p>
            
            <div class="chart-wrapper">
                <div class="chart-area"><canvas id="chartAvoided"></canvas></div>
                <div class="info-area">
                    <h4>Beneficio Ambiental 2024</h4>
                    <p>Solo en el año 2024, la energía solar evitó la emisión de aproximadamente <span class="highlight" id="valAvoided24"></span> millones de toneladas de CO₂e.</p>
                </div>
            </div>
        </section>

    </main>

    <div class="references">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h3>Referencias Bibliográficas</h3>
            <ul>
                <li>Centro Nacional de Control de Energía (CENACE) <a href="https://www.cenace.gob.mx/Paginas/SIM/Reportes/EnergiaGeneradaTipoTec.aspx" target="_blank">https://www.cenace.gob.mx/Paginas/SIM/Reportes/EnergiaGeneradaTipoTec.aspx</a></li>
                <li>Plan de Desarrollo del Sector Eléctrico (PDSE)</li>
                <li>Programa de Desarrollo del Sistema Eléctrico Nacional (PRODESEN) <a href="https://www.cenace.gob.mx/Docs/16_MARCOREGULATORIO/Prodecen/20%202024-2038%20Cap%C3%ADtulos%201%20al%206.pdf" target="_blank">https://www.cenace.gob.mx/Docs/16_MARCOREGULATORIO/Prodecen/20%202024-2038%20Cap%C3%ADtulos%201%20al%206.pdf</a></li>
                <li>Sistema de Información Energética (SIE) <a href="https://sie.energia.gob.mx/inicio/" target="_blank">https://sie.energia.gob.mx/inicio/</a></li>
            </ul>
        </div>
    </div>

    <footer><p>&copy; 2025 SP-Energy.</p></footer>

    <script>
        // 1. DATOS EXACTOS (Transcritus de tu imagen)
        // Solo usamos 2015-2024 porque es donde tienes el Factor Real.
        const years = [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];
        
        // TUS DATOS REALES (Imagen image_658547.png)
        const factorEmision = [0.456, 0.458, 0.496, 0.527, 0.505, 0.494, 0.423, 0.435, 0.438, 0.425];

        // CONSUMO BRUTO (Filtrado para 2015-2024 de tus datos originales)
        // Original completo: [253460, 269831, 275033, 275497, 280161, 288224 (2015), 298792, 309726, 318233, 324921, 315969, 329032, 340613, 351584, 359807]
        const consumoBrutoSubset = [288224, 298792, 309726, 318233, 324921, 315969, 329032, 340613, 351584, 359807];

        // GENERACIÓN SOLAR (Filtrado para 2015-2024)
        // Original completo: [..., 45 (2015), 151, 349, 2176, 8394, 13528, 17069, 16290, 18210, 18640]
        const genSolarSubset = [45, 151, 349, 2176, 8394, 13528, 17069, 16290, 18210, 18640];

        // CÁLCULOS
        // Emisiones = (GWh * 1000) * Factor / 1,000,000 (Para Millones de Toneladas)
        const emisionesTotales = consumoBrutoSubset.map((cons, i) => {
            return (cons * 1000 * factorEmision[i]) / 1000000;
        });

        const emisionesEvitadas = genSolarSubset.map((gen, i) => {
            return (gen * 1000 * factorEmision[i]) / 1000000;
        });

        // --- GRÁFICAS ---

        function initFactorChart() {
            const ctx = document.getElementById('chartFactor');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Factor de Emisión (tCO₂e/MWh)',
                        data: factorEmision,
                        borderColor: '#d35400', // Color óxido
                        backgroundColor: 'rgba(211, 84, 0, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHitRadius: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'nearest', intersect: true },
                    plugins: { legend: { display: false } },
                    scales: { y: { title: { display: true, text: 'tCO₂e / MWh' } } }
                }
            });

            // Tabla Factor
            const tbody = document.getElementById('factorTableBody');
            years.forEach((y, i) => {
                tbody.innerHTML += `<tr><td>${y}</td><td>${factorEmision[i].toFixed(3)}</td></tr>`;
            });
            document.getElementById('valFactor24').innerText = factorEmision[factorEmision.length-1];
        }

        function initEmissionsChart() {
            const ctx = document.getElementById('chartEmissions');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Emisiones GEI (Millones tCO₂e)',
                        data: emisionesTotales,
                        borderColor: '#c0392b',
                        backgroundColor: 'rgba(192, 57, 43, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointRadius: 4,
                        pointHitRadius: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'nearest', intersect: true },
                    scales: { y: { title: { display: true, text: 'Millones Toneladas' } } }
                }
            });

            // Texto Evolución
            const start = emisionesTotales[0];
            const end = emisionesTotales[emisionesTotales.length - 1];
            const pct = ((end - start) / start) * 100;
            const sign = pct >= 0 ? '+' : '';

            document.getElementById('emissionsInfo').innerHTML = `
                <h4>Evolución al 2024</h4>
                <p>Las emisiones totales estimadas pasaron de <strong>${start.toFixed(1)}</strong> Millones tCO₂e en 2015 a <strong>${end.toFixed(1)}</strong> Millones en 2024.</p>
                <p>Variación en el periodo: <span class="highlight">${sign}${pct.toFixed(1)}%</span>.</p>
            `;
        }

        function initAvoidedChart() {
            const ctx = document.getElementById('chartAvoided');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Emisiones Evitadas (Millones tCO₂e)',
                        data: emisionesEvitadas,
                        backgroundColor: 'rgba(39, 174, 96, 0.6)',
                        borderColor: '#27ae60',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'nearest', intersect: true },
                    scales: { y: { title: { display: true, text: 'Millones Toneladas' } } }
                }
            });
            document.getElementById('valAvoided24').innerText = emisionesEvitadas[emisionesEvitadas.length - 1].toFixed(2);
        }

        window.onload = function() {
            initFactorChart();
            initEmissionsChart();
            initAvoidedChart();

            // Toggle Botones
            const btnChart = document.getElementById('btnFactorChart');
            const btnTable = document.getElementById('btnFactorTable');
            const divChart = document.getElementById('factorChartContainer');
            const divTable = document.getElementById('factorTableContainer');

            btnChart.onclick = () => { divChart.style.display=''; divTable.style.display='none'; btnChart.classList.add('primary'); btnTable.classList.remove('primary'); };
            btnTable.onclick = () => { divChart.style.display='none'; divTable.style.display=''; btnTable.classList.add('primary'); btnChart.classList.remove('primary'); };
        };
    </script>
</body>
</html>
