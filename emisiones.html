<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SP-Energy | Emisiones</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Layout Gráfica + Info */
        .chart-wrapper { display: flex; flex-wrap: wrap; gap: 20px; align-items: center; margin-top: 1rem; }
        .chart-area { flex: 3; min-width: 300px; height: 400px; }
        .info-area { 
            flex: 1; min-width: 250px; background: #fff; padding: 25px; 
            border-radius: 8px; border-top: 5px solid #FFD700; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.08); 
        }
        .info-area h4 { margin-top: 0; color: #333; font-size: 1.1rem; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .info-area p { font-size: 1rem; line-height: 1.6; color: #555; margin-bottom: 10px; }
        .highlight { color: #d35400; font-weight: bold; }

        /* Fórmula Limpia */
        .formula-box {
            background-color: #fdfdfd;
            border: 1px solid #ddd;
            border-left: 4px solid #2980b9;
            padding: 20px;
            margin-bottom: 25px;
            border-radius: 4px;
            text-align: center;
            font-family: 'Roboto', sans-serif;
            color: #444;
        }
        .formula-text { font-size: 1.2rem; font-weight: 500; letter-spacing: 0.5px; }
        .formula-sub { display: block; margin-top: 5px; font-size: 0.9rem; color: #777; }

        /* Referencias */
        .references { background: #2c3e50; color: #fff; padding: 40px 20px; margin-top: 50px; }
        .references h3 { color: #FFD700; border-bottom: 1px solid #555; padding-bottom: 10px; margin-bottom: 20px; }
        .references ul { list-style: none; padding: 0; }
        .references li { margin-bottom: 15px; }
        .references a { color: #fff; text-decoration: underline; }
        .references a:hover { color: #FFD700; }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="logo-container"><span class="logo-text">SP-ENERGY <span class="sun-icon">☀️</span></span></div>
        <div class="slogan-container"><h1>Energía Solar para Todos</h1></div>
        <div class="spacer"></div> 
    </header>

    <nav class="navbar">
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="mapa.html">Mapa Interactivo</a></li>
            <li><a href="graficas.html">Gráficas y Tablas</a></li>
            <li><a href="emisiones.html" class="active">Emisiones</a></li>
            <li><a href="info.html">Contacto</a></li>
        </ul>
    </nav>

    <main class="main-container">
        <h2 class="section-title">Impacto Ambiental y Emisiones de GEI</h2>

        <section class="graph-card">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
                <h2>Factor de Emisión del SEN (2015–2024)</h2>
                <div class="view-toggle">
                    <button id="btnFactorChart" class="btn primary">Ver gráfica</button>
                    <button id="btnFactorTable" class="btn">Ver tabla</button>
                </div>
            </div>
            <p>Evolución histórica del factor de emisión eléctrico (tCO₂e/MWh).</p>

            <div id="factorChartContainer">
                <div class="chart-wrapper">
                    <div class="chart-area"><canvas id="chartFactor"></canvas></div>
                    <div class="info-area">
                        <h4>Dato Actual</h4>
                        <p>El factor de emisión eléctrico en 2024 es de <span class="highlight" id="valFactor24"></span> tCO₂e/MWh.</p>
                    </div>
                </div>
            </div>

            <div id="factorTableContainer" style="display:none; overflow-x:auto;">
                <table class="data-table">
                    <thead><tr><th>Año</th><th>Factor (tCO₂e/MWh)</th></tr></thead>
                    <tbody id="factorTableBody"></tbody>
                </table>
            </div>
        </section>

        <section class="graph-card">
            <h2>Emisiones Totales Asociadas a la Generación</h2>
            
            <div class="formula-box">
                <span class="formula-text">Emisiones (tCO₂e) = Consumo Bruto (MWh) × Factor de Emisión (tCO₂e/MWh)</span>
                <span class="formula-sub">Cálculo de emisiones totales generadas por el Sistema Eléctrico Nacional.</span>
            </div>

            <div class="chart-wrapper">
                <div class="chart-area"><canvas id="chartEmissions"></canvas></div>
                <div class="info-area" id="emissionsInfo">
                    <h4>Evolución al 2024</h4>
                    </div>
            </div>
        </section>

        <section class="graph-card" style="border-top: 5px solid #27ae60;">
            <h2>Impacto Positivo: Emisiones Evitadas</h2>
            <p>Estimación de CO₂e no emitido gracias a la generación solar fotovoltaica.</p>
            
            <div class="chart-wrapper">
                <div class="chart-area"><canvas id="chartAvoided"></canvas></div>
                <div class="info-area">
                    <h4>Ahorro Ambiental</h4>
                    <p>En 2024, la generación solar fotovoltaica evitó la emisión de aproximadamente <span class="highlight" id="valAvoided24"></span> Millones de Toneladas de CO₂e.</p>
                </div>
            </div>
        </section>

    </main>

    <div class="references">
        <div style="max-width: 1200px; margin: 0 auto;">
            <h3>Referencias Bibliográficas</h3>
            <ul>
                <li>Centro Nacional de Control de Energía (CENACE) <a href="https://www.cenace.gob.mx/Paginas/SIM/Reportes/EnergiaGeneradaTipoTec.aspx" target="_blank">Ver reporte</a></li>
                <li>Plan de Desarrollo del Sector Eléctrico (PDSE)</li>
                <li>Programa de Desarrollo del Sistema Eléctrico Nacional (PRODESEN) <a href="https://www.cenace.gob.mx/Docs/16_MARCOREGULATORIO/Prodecen/20%202024-2038%20Cap%C3%ADtulos%201%20al%206.pdf" target="_blank">Ver documento</a></li>
                <li>Sistema de Información Energética (SIE) <a href="https://sie.energia.gob.mx/inicio/" target="_blank">Ir al sitio</a></li>
            </ul>
        </div>
    </div>

    <footer><p>&copy; 2025 SP-Energy.</p></footer>

    <script>
        const years = [2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];
        
        // 1. DATOS CORRECTOS (Proporcionados por ti)
        const factorEmision = [0.454, 0.582, 0.582, 0.527, 0.505, 0.494, 0.423, 0.435, 0.438, 0.444];

        // Datos Consumo y Generación (2015-2024)
        const consumoBruto = [288224, 298792, 309726, 318233, 324921, 315969, 329032, 340613, 351584, 359807];
        const genSolar = [45, 151, 349, 2176, 8394, 13528, 17069, 16290, 18210, 18640];

        // CÁLCULOS
        const emisionesTotales = consumoBruto.map((c, i) => (c * 1000 * factorEmision[i]) / 1000000);
        const emisionesEvitadas = genSolar.map((g, i) => (g * 1000 * factorEmision[i]) / 1000000);

        // --- GRÁFICAS ---

        function initFactorChart() {
            const ctx = document.getElementById('chartFactor');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Factor (tCO₂e/MWh)',
                        data: factorEmision,
                        borderColor: '#d35400',
                        backgroundColor: 'rgba(211, 84, 0, 0.1)',
                        borderWidth: 2,
                        tension: 0.2,
                        pointRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false } }
            });

            // Tabla
            const tbody = document.getElementById('factorTableBody');
            years.forEach((y, i) => { tbody.innerHTML += `<tr><td>${y}</td><td>${factorEmision[i]}</td></tr>`; });
            document.getElementById('valFactor24').innerText = factorEmision[factorEmision.length-1];
        }

        function initEmissionsChart() {
            const ctx = document.getElementById('chartEmissions');
            new Chart(ctx, {
                type: 'bar', // Barra Vertical
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Emisiones (Millones tCO₂e)',
                        data: emisionesTotales,
                        backgroundColor: 'rgba(192, 57, 43, 0.7)',
                        borderColor: '#c0392b',
                        borderWidth: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // Texto Evolución
            const start = emisionesTotales[0];
            const end = emisionesTotales[emisionesTotales.length - 1];
            const pct = ((end - start) / start) * 100;
            const sign = pct >= 0 ? '+' : '';

            document.getElementById('emissionsInfo').innerHTML = `
                <h4>Evolución al 2024</h4>
                <p>Las emisiones totales del SEN pasaron de <strong>${start.toFixed(1)}</strong> Millones tCO₂e en 2015 a <strong>${end.toFixed(1)}</strong> Millones en 2024.</p>
                <p>Variación en el periodo: <span class="highlight">${sign}${pct.toFixed(1)}%</span>.</p>
            `;
        }

        function initAvoidedChart() {
            const ctx = document.getElementById('chartAvoided');
            new Chart(ctx, {
                type: 'bar', // Barra Vertical
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Evitadas (Millones tCO₂e)',
                        data: emisionesEvitadas,
                        backgroundColor: '#27ae60',
                        borderRadius: 4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
            document.getElementById('valAvoided24').innerText = emisionesEvitadas[emisionesEvitadas.length - 1].toFixed(2);
        }

        window.onload = function() {
            initFactorChart();
            initEmissionsChart();
            initAvoidedChart();

            const btnC = document.getElementById('btnFactorChart');
            const btnT = document.getElementById('btnFactorTable');
            const divC = document.getElementById('factorChartContainer');
            const divT = document.getElementById('factorTableContainer');

            btnC.onclick = () => { divC.style.display=''; divT.style.display='none'; btnC.classList.add('primary'); btnT.classList.remove('primary'); };
            btnT.onclick = () => { divC.style.display='none'; divT.style.display=''; btnT.classList.add('primary'); btnC.classList.remove('primary'); };
        };
    </script>
</body>
</html>
